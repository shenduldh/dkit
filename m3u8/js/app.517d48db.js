(function(e){function t(t){for(var a,i,o=t[0],c=t[1],l=t[2],d=0,b=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&b.push(n[i][0]),n[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(b.length)b.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],a=!0,o=1;o<s.length;o++){var c=s[o];0!==n[c]&&(a=!1)}a&&(r.splice(t--,1),e=i(i.s=s[0]))}return e}var a={},n={app:0},r=[];function i(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=a,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;r.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("cd49")},"010b":function(e,t,s){},"1cb7":function(e,t,s){"use strict";s("7ed5")},6235:function(e,t,s){"use strict";s("8ab1")},"6abe":function(e,t,s){"use strict";s("8a1f")},"7ed5":function(e,t,s){},"8a1f":function(e,t,s){},"8ab1":function(e,t,s){},cd49:function(e,t,s){"use strict";s.r(t);var a=s("7a23");const n=e=>(Object(a["o"])("data-v-412c04ed"),e=e(),Object(a["m"])(),e),r={class:"body"},i=n(()=>Object(a["e"])("p",{class:"display-4 text-center"},"m3u8下载器",-1)),o=n(()=>Object(a["e"])("p",{class:"lead text-center"},"testURL: https://cdn.theoplayer.com/video/big_buck_bunny_encrypted/stream-800/index.m3u8",-1));function c(e,t,s,n,c,l){const u=Object(a["s"])("Add"),d=Object(a["s"])("List");return Object(a["l"])(),Object(a["d"])("div",r,[i,o,Object(a["f"])(u),Object(a["f"])(d)])}const l={class:"card mb-2"},u=Object(a["e"])("div",{class:"card-header"},"添加任务",-1),d={class:"card-body"},b={class:"input-group mb-1"},p=Object(a["e"])("div",{class:"input-group-prepend"},[Object(a["e"])("span",{class:"input-group-text"},"名称")],-1),h={class:"input-group mb-1"},O=Object(a["e"])("div",{class:"input-group-prepend"},[Object(a["e"])("span",{class:"input-group-text"},"链接")],-1),v={class:"input-group-append"},j=["disabled"],m={class:"input-group mb-1"},y=Object(a["e"])("div",{class:"input-group-prepend"},[Object(a["e"])("span",{class:"input-group-text"},"上传")],-1),f=["value"],k={class:"input-group-append"},w=["disabled"];function g(e,t,s,n,r,i){return Object(a["l"])(),Object(a["d"])("div",l,[u,Object(a["e"])("div",d,[Object(a["e"])("div",b,[p,Object(a["z"])(Object(a["e"])("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=t=>e.name=t),placeholder:"默认为“任务+id+日期”, 若是上传, 则默认为上传文件名"},null,512),[[a["w"],e.name]])]),Object(a["e"])("div",h,[O,Object(a["z"])(Object(a["e"])("input",{type:"url",class:"form-control",placeholder:"通过 m3u8 链接下载, 请在此处输入 m3u8 视频的链接, 然后点击确定","onUpdate:modelValue":t[1]||(t[1]=t=>e.url=t)},null,512),[[a["w"],e.url]]),Object(a["e"])("div",v,[Object(a["e"])("button",{class:"btn btn-primary",disabled:!e.url,onClick:t[2]||(t[2]=(...t)=>e.addTaskByURL&&e.addTaskByURL(...t))},"确定",8,j)])]),Object(a["e"])("div",m,[y,Object(a["e"])("input",{type:"text",onClick:t[3]||(t[3]=(...t)=>e.upload&&e.upload(...t)),class:"form-control",style:{cursor:"pointer","caret-color":"transparent"},value:e.filename,placeholder:"通过 m3u8 文件下载, 请点击此处上传后缀为 .m3u8 的文件, 然后点击确定"},null,8,f),Object(a["e"])("div",k,[Object(a["e"])("button",{class:"btn btn-primary",disabled:!e.fileContent,onClick:t[4]||(t[4]=(...t)=>e.addTaskByFile&&e.addTaskByFile(...t))},"确定",8,w)])])])])}var S;(function(e){e["Loading"]="Loading",e["Ready"]="Ready",e["Ok"]="OK",e["Fail"]="Fail"})(S||(S={}));var A=Object(a["g"])({methods:{async upload(){const e=(await window.showOpenFilePicker())[0],t=await e.getFile();/.m3u8$/.test(t.name)?(this.filename=t.name,this.fileContent=await t.text()):window.alert("请上传 m3u8 格式的文件!")},addTaskByURL(){const e=++this.taskIndex,t=new Date,s={id:e,name:this.name||`任务${e}_${t.getMonth()+1}-${t.getDate()}`,url:this.url,content:"",status:S.Loading,progress:0,duration:0,chipArray:[],keys:new Map,isUseMP4Format:!0};this.taskList.push(s),this.clearInputs()},addTaskByFile(){const e=++this.taskIndex,t={id:e,name:this.name||this.filename.slice(0,-5),url:"",content:this.fileContent,status:S.Loading,progress:0,duration:0,chipArray:[],keys:new Map,isUseMP4Format:!0};this.taskList.push(t),this.clearInputs()},clearInputs(){this.name="",this.filename="",this.fileContent="",this.url=""}},setup(){const e=Object(a["h"])("taskList"),t=Object(a["q"])(0),s=Object(a["q"])(""),n=Object(a["q"])(""),r=Object(a["q"])(""),i=Object(a["q"])("");return{taskList:e,taskIndex:t,url:n,name:s,fileContent:r,filename:i}}}),x=s("6b0d"),C=s.n(x);const U=C()(A,[["render",g]]);var _=U;const R=e=>(Object(a["o"])("data-v-459b8f5a"),e=e(),Object(a["m"])(),e),T={class:"card"},M=R(()=>Object(a["e"])("div",{class:"card-header"},"任务详情",-1)),P={class:"card-body"},F={class:"btn-toolbar mb-2"},L={class:"btn-group"},q={class:"input-group ms-2"},B=R(()=>Object(a["e"])("div",{class:"input-group-prepend"},[Object(a["e"])("span",{class:"input-group-text"},"线程数")],-1)),W={class:"list-group"};function I(e,t,s,n,r,i){const o=Object(a["s"])("TaskComp");return Object(a["l"])(),Object(a["d"])("div",T,[M,Object(a["e"])("div",P,[Object(a["e"])("div",F,[Object(a["e"])("div",L,[Object(a["e"])("button",{onClick:t[0]||(t[0]=(...t)=>e.changeWorkerStatus&&e.changeWorkerStatus(...t)),class:"btn btn-dark"},Object(a["t"])(e.isRunning?"停止":"启动")+"下载线程 ",1),Object(a["e"])("button",{onClick:t[1]||(t[1]=(...t)=>e.autoRetryAll&&e.autoRetryAll(...t)),class:"btn btn-dark"},Object(a["t"])(e.isRetring?"关闭":"自动")+"重试错误片段 ",1)]),Object(a["e"])("div",q,[B,Object(a["z"])(Object(a["e"])("input",{type:"number",class:"form-control",min:"1",style:{width:"70px"},"onUpdate:modelValue":t[2]||(t[2]=t=>e.workerCount=t),onChange:t[3]||(t[3]=(...t)=>e.adjustWorkerCount&&e.adjustWorkerCount(...t))},null,544),[[a["w"],e.workerCount]])])]),Object(a["e"])("ul",W,[(Object(a["l"])(!0),Object(a["d"])(a["a"],null,Object(a["r"])(e.taskList,t=>(Object(a["l"])(),Object(a["d"])("li",{class:"list-group-item",key:t.id},[Object(a["f"])(o,{task:t,manager:e.manager,remove:e.remove},null,8,["task","manager","remove"])]))),128))])])])}const D={class:"lead mb-1"},E={class:"me-2 font-monospace"},z={class:"badge bg-warning ms-1"},K={class:"ms-2 font-monospace",style:{"font-size":"16px"}},V={class:"progress mb-2"},$={class:"btn-group mb-1"},H=["disabled"],J=["disabled"],N=["disabled","id"],X=["for"],Y=["disabled","id"],G=["for"];function Q(e,t,s,n,r,i){const o=Object(a["s"])("Detail");return Object(a["l"])(),Object(a["d"])(a["a"],null,[Object(a["e"])("p",D,[Object(a["e"])("span",E,Object(a["t"])(e.task.name),1),Object(a["e"])("span",{onClick:t[0]||(t[0]=(...t)=>e.retryTask&&e.retryTask(...t)),class:Object(a["i"])(e.taskStatusClass)},Object(a["t"])(e.task.status),3),Object(a["z"])(Object(a["e"])("span",z,"加密",512),[[a["x"],e.isShowEncryptedBadge]]),Object(a["e"])("span",K,Object(a["t"])(e.hours)+":"+Object(a["t"])(e.minutes)+":"+Object(a["t"])(e.seconds),1)]),Object(a["e"])("div",V,[Object(a["e"])("span",{class:"progress-bar progress-bar-striped bg-success",style:Object(a["j"])({width:Math.floor(100*e.task.progress/e.task.chipArray.length)+"%"})},null,4)]),Object(a["e"])("div",$,[Object(a["e"])("button",{onClick:t[1]||(t[1]=(...t)=>e.handleSPRBtn&&e.handleSPRBtn(...t)),disabled:e.task.status!==e.Status.Ready,class:"btn btn-primary btn-sm"},Object(a["t"])(e.textOfSPRBtn),9,H),Object(a["e"])("button",{onClick:t[2]||(t[2]=(...t)=>e.retryAllChips&&e.retryAllChips(...t)),disabled:!e.isNeedRetryChips,class:"btn btn-info btn-sm text-white"},"重试错误片段",8,J),Object(a["e"])("button",{onClick:t[3]||(t[3]=t=>e.remove(e.task.id)),class:"btn btn-danger btn-sm"},"删除"),Object(a["e"])("button",{onClick:t[4]||(t[4]=t=>e.isShowDetail=!e.isShowDetail),class:"btn btn-secondary btn-sm"}," 详情 "),Object(a["z"])(Object(a["e"])("input",{type:"checkbox",disabled:e.isStarted,class:"btn-check","onUpdate:modelValue":t[5]||(t[5]=t=>e.isUseMP4Format=t),id:e.task.id+"useMP4Format"},null,8,N),[[a["v"],e.isUseMP4Format]]),Object(a["e"])("label",{class:"btn btn-outline-dark btn-sm",for:e.task.id+"useMP4Format"},"将保存为 "+Object(a["t"])(e.isUseMP4Format?"mp4":"ts")+" 格式",9,X),Object(a["z"])(Object(a["e"])("input",{type:"checkbox",disabled:e.isStarted,class:"btn-check","onUpdate:modelValue":t[6]||(t[6]=t=>e.isSaveWhileDownloading=t),id:e.task.id+"saveWhileDownloading"},null,8,Y),[[a["v"],e.isSaveWhileDownloading]]),Object(a["e"])("label",{class:"btn btn-outline-success btn-sm",for:e.task.id+"saveWhileDownloading"},"已"+Object(a["t"])(e.isSaveWhileDownloading?"开启":"关闭")+"边下载边保存功能",9,G),Object(a["z"])(Object(a["e"])("button",{onClick:t[7]||(t[7]=(...t)=>e.saveChips&&e.saveChips(...t)),class:"btn btn-success btn-sm"},"保存已下载片段",512),[[a["x"],!e.isSaveWhileDownloading]])]),Object(a["z"])(Object(a["e"])("div",null,[(Object(a["l"])(!0),Object(a["d"])(a["a"],null,Object(a["r"])(e.task.chipArray,(t,s)=>(Object(a["l"])(),Object(a["c"])(o,{key:s,chip:t,onClick:s=>e.retryChip(t)},null,8,["chip","onClick"]))),128))],512),[[a["x"],e.isShowDetail]])],64)}s("13d5");function Z(e,t,s,n,r,i){return Object(a["l"])(),Object(a["d"])("div",{class:Object(a["i"])(e.detailClass)},null,2)}var ee=Object(a["g"])({props:{chip:{type:Object,required:!0}},setup(e){const t=Object(a["q"])("rounded");return Object(a["y"])(()=>{const s=e.chip.status;s!==S.Loading?s!==S.Ready?s!==S.Ok?s!==S.Fail||(t.value="rounded fail"):t.value="rounded ok":t.value="rounded ready":t.value="rounded loading"}),{detailClass:t}}});s("6235");const te=C()(ee,[["render",Z],["__scopeId","data-v-9771496a"]]);var se=te,ae=(e,t,s=!1)=>{fetch(e).then(e=>s?e.arrayBuffer():e.text()).then(e=>t.success&&t.success(e)).catch(e=>t.fail&&t.fail(e))};const ne=async(e,t=!1)=>await fetch(e).then(e=>t?e.arrayBuffer():e.text());var re=(e,t)=>{t=t||location.href;let s="";if(/^http/.test(e))s=e;else if("/"===e[0]){const a=t.split("/");s=a[0]+"//"+a[2]+e}else s=t.replace(/\/[^/]*?$/,"/"+e);return s},ie=(e,t,s=!0)=>{let a,n;s?(a=new Blob(e,{type:"video/mp4"}),n=t+".mp4"):(a=new Blob(e,{type:"video/MP2T"}),n=t+".ts");const r=document.createElement("a");r.download=n,r.href=URL.createObjectURL(a),r.style.display="none",document.body.appendChild(r),r.click(),r.remove()},oe=(s("3c5d"),s("ade3"));class ce{constructor(){Object(oe["a"])(this,"rcon",[0,1,2,4,8,16,32,64,128,27,54]),Object(oe["a"])(this,"subMix",[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]),Object(oe["a"])(this,"invSubMix",[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]),Object(oe["a"])(this,"sBox",new Uint32Array(256)),Object(oe["a"])(this,"invSBox",new Uint32Array(256)),Object(oe["a"])(this,"key",new Uint32Array(0)),Object(oe["a"])(this,"ksRows",0),Object(oe["a"])(this,"keySize",0),Object(oe["a"])(this,"keySchedule",void 0),Object(oe["a"])(this,"invKeySchedule",void 0),this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let a=0;a<4;a++)s[a]=t.getUint32(4*a);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,a=s[0],n=s[1],r=s[2],i=s[3],o=this.invSubMix,c=o[0],l=o[1],u=o[2],d=o[3],b=new Uint32Array(256);let p=0,h=0,O=0;for(O=0;O<256;O++)b[O]=O<128?O<<1:O<<1^283;for(O=0;O<256;O++){let s=h^h<<1^h<<2^h<<3^h<<4;s=s>>>8^255&s^99,e[p]=s,t[s]=p;const o=b[p],O=b[o],v=b[O];let j=257*b[s]^16843008*s;a[p]=j<<24|j>>>8,n[p]=j<<16|j>>>16,r[p]=j<<8|j>>>24,i[p]=j,j=16843009*v^65537*O^257*o^16843008*p,c[s]=j<<24|j>>>8,l[s]=j<<16|j>>>16,u[s]=j<<8|j>>>24,d[s]=j,p?(p=o^b[b[b[v^o]]],h^=b[b[h]]):p=h=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,a=0;while(a<t.length&&s)s=t[a]===this.key[a],a++;if(s)return;this.key=t;const n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);const r=this.ksRows=4*(n+6+1);let i,o;const c=this.keySchedule=new Uint32Array(r),l=this.invKeySchedule=new Uint32Array(r),u=this.sBox,d=this.rcon,b=this.invSubMix,p=b[0],h=b[1],O=b[2],v=b[3];let j,m;for(i=0;i<r;i++)i<n?j=c[i]=t[i]:(m=j,i%n===0?(m=m<<8|m>>>24,m=u[m>>>24]<<24|u[m>>>16&255]<<16|u[m>>>8&255]<<8|u[255&m],m^=d[i/n|0]<<24):n>6&&i%n===4&&(m=u[m>>>24]<<24|u[m>>>16&255]<<16|u[m>>>8&255]<<8|u[255&m]),c[i]=j=(c[i-n]^m)>>>0);for(o=0;o<r;o++)i=r-o,m=3&o?c[i]:c[i-4],l[o]=o<4||i<=4?m:p[u[m>>>24]]^h[u[m>>>16&255]]^O[u[m>>>8&255]]^v[u[255&m]],l[o]=l[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,s){const a=this.keySize+6,n=this.invKeySchedule,r=this.invSBox,i=this.invSubMix,o=i[0],c=i[1],l=i[2],u=i[3],d=this.uint8ArrayToUint32Array_(s);let b=d[0],p=d[1],h=d[2],O=d[3];const v=new Int32Array(e),j=new Int32Array(v.length);let m,y,f,k,w,g,S,A,x,C,U,_,R,T;const M=this.networkToHostOrderSwap;while(t<v.length){for(x=M(v[t]),C=M(v[t+1]),U=M(v[t+2]),_=M(v[t+3]),w=x^n[0],g=_^n[1],S=U^n[2],A=C^n[3],R=4,T=1;T<a;T++)m=o[w>>>24]^c[g>>16&255]^l[S>>8&255]^u[255&A]^n[R],y=o[g>>>24]^c[S>>16&255]^l[A>>8&255]^u[255&w]^n[R+1],f=o[S>>>24]^c[A>>16&255]^l[w>>8&255]^u[255&g]^n[R+2],k=o[A>>>24]^c[w>>16&255]^l[g>>8&255]^u[255&S]^n[R+3],w=m,g=y,S=f,A=k,R+=4;m=r[w>>>24]<<24^r[g>>16&255]<<16^r[S>>8&255]<<8^r[255&A]^n[R],y=r[g>>>24]<<24^r[S>>16&255]<<16^r[A>>8&255]<<8^r[255&w]^n[R+1],f=r[S>>>24]<<24^r[A>>16&255]<<16^r[w>>8&255]<<8^r[255&g]^n[R+2],k=r[A>>>24]<<24^r[w>>16&255]<<16^r[g>>8&255]<<8^r[255&S]^n[R+3],j[t]=M(m^b),j[t+1]=M(k^p),j[t+2]=M(f^h),j[t+3]=M(y^O),b=x,p=C,h=U,O=_,t+=4}return j.buffer}}const le=e=>new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e]).buffer;var ue=s("e9e4"),de=s.n(ue),be=(e,t=188)=>{let s=0,a=!0;while(a){if(s>=t)return 0;const n=new Uint8Array(e.slice(s,s+4));s++;const r=n[0].toString(16);if("47"!==r)continue;const i=((128&n[1])>>>7).toString(2);if("0"!==i)continue;const o=((192&n[3])>>>6).toString(2);if("01"===o)continue;const c=((48&n[3])>>>4).toString(2);"00"!==c&&(a=!1)}return s-1};const pe=new ce,he=(e,t,s)=>new Promise((a,n)=>{const r=new de.a.mp4.Transmuxer({keepOriginalTimestamps:!0,duration:Math.round(t)});r.on("data",e=>{let t;0===s?(t=new Uint8Array(e.initSegment.byteLength+e.data.byteLength),t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength),t=t.buffer):t=e.data,a(t)}),r.push(new Uint8Array(e)),r.flush()});var Oe=(e,t)=>{const s=async()=>{try{e.status=S.Loading;let s=null;if(e.aes){const a=re(e.aes.uri,t.url);t.keys.has(a)?s=t.keys.get(a):(s=await ne(a,!0),t.keys.set(a,s))}let a=await ne(e.url,!0);s&&(pe.expandKey(s),a=pe.decrypt(a,0,e.aes.iv));const n=be(a);if(a=a.slice(n),t.isUseMP4Format&&(a=await he(a,t.duration,e.offset)),e.data=a,e.status=S.Ok,t.progress++,t.stream){for(let e=t.stream.index;e<t.chipArray.length;e++){const s=t.chipArray[e].data;if(null===s)break;t.stream.writer.write(new Uint8Array(s)),t.chipArray[e].data=null,t.stream.index++}t.stream.index>=t.chipArray.length&&t.stream.writer.close()}}catch(s){console.error(s),e.status=S.Fail}};return s.id=t.id,s},ve=s("d749"),je=s("3717"),me=s.n(je),ye=Object(a["g"])({components:{Detail:se},props:{task:{type:Object,required:!0},manager:{type:Object,required:!0},remove:{type:Function,required:!0}},computed:{textOfSPRBtn(){return this.task.status===S.Ok?"下载完成":this.isStarted?this.isRunning?"暂停下载":"恢复下载":"开始下载"},isNeedRetryChips(){return!!this.task.chipArray.some(e=>e.status===S.Fail)}},setup(e){const{task:t,manager:s}=Object(a["u"])(e),n=new ve["a"],r=Object(a["q"])(0),i=Object(a["q"])(0),o=Object(a["q"])(0),c=Object(a["q"])(""),l=Object(a["q"])(!1),u=Object(a["q"])(!1),d=Object(a["q"])(!0),b=Object(a["q"])(me.a.supported),p=Object(a["q"])(!1),h=Object(a["q"])(!1),O=()=>{const e=t.value.content;n.push(e),n.end();const s=n.manifest,c=s.segments;if(0===c.length)return t.value.status=S.Fail,void console.error(`任务${t.value.name}没有检测到ts片段!`);const u=c.reduce((e,t)=>e+t.duration||0,0);t.value.duration=u,r.value=Math.floor(u/3600),i.value=Math.floor((u-3600*r.value)/60),o.value=Math.ceil(u-3600*r.value-60*i.value),e.indexOf("#EXT-X-KEY")>-1&&(l.value=!0),c.forEach((e,s)=>{const n=Object(a["p"])({url:re(e.uri,t.value.url),status:S.Ready,data:null,offset:s,aes:e.key?{method:e.key.method||"",uri:e.key.uri||"",iv:e.iv?e.iv.buffer:le(s),key:null}:null});t.value.chipArray.push(n)}),t.value.status=S.Ready},v=async()=>{t.value.content?O():ae(t.value.url,{success(e){const s=e;t.value.content=s,O()},fail(){t.value.status=S.Fail}})};Object(a["k"])(v);const j=()=>{t.value.status===S.Fail&&(t.value.status=S.Loading,v())},m=()=>{if(p.value=!0,h.value=!0,t.value.isUseMP4Format=d.value,b.value){me.a.mitm="./mitm.html";const e=t.value.name+(d.value?".mp4":".ts");t.value.stream={writer:me.a.createWriteStream(e).getWriter(),index:0}}t.value.chipArray.forEach(e=>s.value.submit(Oe(e,t.value)))},y=()=>{h.value=!1,e.manager.pauseTask(t.value.id)},f=()=>{h.value=!0,e.manager.restoreTask(t.value.id)},k=()=>{p.value?h.value?y():f():m()},w=s=>{s.status===S.Fail&&(s.status=S.Ready,e.manager.submit(Oe(s,t.value)))},g=()=>{t.value.chipArray.forEach(e=>w(e))},A=()=>{ie(t.value.chipArray.map(e=>e.data),t.value.name,t.value.isUseMP4Format)};return Object(a["y"])(()=>{const e=t.value.status,s=t.value.chipArray;if(e===S.Ready)return c.value="badge bg-primary",void(s.length>0&&s.every(e=>e.status===S.Ok)&&(t.value.status=S.Ok,c.value="badge bg-success",h.value=!1,b.value||A()));e!==S.Fail?e!==S.Loading||(c.value="badge bg-secondary"):c.value="badge bg-danger cursor"}),{handleSPRBtn:k,saveChips:A,retryChip:w,retryAllChips:g,retryTask:j,isStarted:p,isRunning:h,isShowDetail:u,isShowEncryptedBadge:l,isUseMP4Format:d,isSaveWhileDownloading:b,taskStatusClass:c,hours:r,minutes:i,seconds:o,Status:S}}});s("6abe");const fe=C()(ye,[["render",Q],["__scopeId","data-v-335c5ce9"]]);var ke=fe;let we=[];const ge=[];class Se{constructor(){Object(oe["a"])(this,"_timer",void 0),Object(oe["a"])(this,"isPaused",!1),this._work()}async _work(){if(!this.isPaused)if(we.length>0){const e=we.shift();ge.findIndex(t=>t===e.id)>=0?(we.push(e),this._wait()):(await e(),this._work())}else this._wait()}_wait(e=1){clearTimeout(this._timer),this._timer=setTimeout(()=>{this._work()},1e3*e)}_run(){clearTimeout(this._timer),this.isPaused=!1,this._work()}_stop(){clearTimeout(this._timer),this.isPaused=!0}}class Ae{constructor(e=10){Object(oe["a"])(this,"workerCount",void 0),Object(oe["a"])(this,"workers",[]),this.workerCount=e;for(let t=this.workerCount;t--;)this.workers.push(new Se)}submit(e){we.push(e)}pauseTask(e){ge.push(e)}restoreTask(e){const t=ge.findIndex(t=>t===e);ge.splice(t,1)}stopWorkers(){this.workers.forEach(e=>e._stop())}runWorkers(){this.workers.forEach(e=>e._run())}remove(e){we=we.filter(t=>t.id!==e)}adjust(e){if(!(e<=0)&&this.workers.length!==e)if(this.workerCount=e,e>this.workers.length){const t=e-this.workers.length;for(let e=t;e--;)this.workers.push(new Se),console.info("A worker joins.")}else{const t=this.workers.length-e;for(let e=t;e--;){const e=this.workers.pop();e._stop(),console.info("A worker leaved.")}}}isWorking(){return we.length>0}}var xe=Ae,Ce=Object(a["g"])({components:{TaskComp:ke},methods:{adjustWorkerCount(){"number"===typeof this.workerCount?this.manager.adjust(this.workerCount):(this.workerCount=10,this.manager.adjust(10))}},setup(){const e=Object(a["h"])("taskList"),t=Object(a["q"])(10),s=new xe(t.value),n=Object(a["q"])(!0),r=()=>{n.value?s.stopWorkers():s.runWorkers(),n.value=!n.value},i=t=>{s.remove(t);const a=e.findIndex(e=>e.id===t),n=e[a];n.stream&&n.stream.writer.abort(),n.chipArray.forEach(e=>e.data=null),e.splice(a,1)},o=Object(a["q"])(!1);let c=void 0;const l=()=>{o.value?clearInterval(c):c=setInterval(()=>{e.forEach(e=>{e.chipArray.forEach(t=>{t.status===S.Fail&&(t.status=S.Ready,s.submit(Oe(t,e)))})})},2e3),o.value=!o.value};return window.onunload=()=>{e.forEach(e=>{e.stream&&e.stream.writer.abort()})},window.onbeforeunload=e=>{s.isWorking()&&(e.returnValue="Are you sure you want to leave?")},{taskList:e,workerCount:t,manager:s,isRunning:n,isRetring:o,changeWorkerStatus:r,autoRetryAll:l,remove:i}}});s("1cb7");const Ue=C()(Ce,[["render",I],["__scopeId","data-v-459b8f5a"]]);var _e=Ue,Re=Object(a["g"])({components:{Add:_,List:_e},setup(){const e=Object(a["p"])([]);Object(a["n"])("taskList",e)}});s("cfbf");const Te=C()(Re,[["render",c],["__scopeId","data-v-412c04ed"]]);var Me=Te;Object(a["b"])(Me).mount("#app")},cfbf:function(e,t,s){"use strict";s("010b")}});
//# sourceMappingURL=app.517d48db.js.map